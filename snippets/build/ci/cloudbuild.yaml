steps:
- name: 'gcr.io/cloud-builders/docker'
  args:
    [ 'build', '-t', 'europe-west4-docker.pkg.dev/$PROJECT_ID/snippets/snippets-image:${_IMAGE_VERSION}', '.' ]
  #this sets the workdir for the build step
  #use this if dockerfile is in subdir from root
  dir: 'snippets'
#PRINT OUT ENV VARS
#- name: 'ubuntu'
#  entrypoint: 'bash'
#  args:
#    - '-c'
#    - |
#      printenv
# deploy container image to GKE
- name: 'gcr.io/cloud-builders/kubectl'
  id: Deploy
  args:
    - 'apply'
    - '-f'
    - '/workspace/deployments/deployment.yaml'
substitutions:
  _IMAGE_VERSION: v3 # default value
images:
  - 'europe-west4-docker.pkg.dev/$PROJECT_ID/snippets/snippets-image:${_IMAGE_VERSION}'

