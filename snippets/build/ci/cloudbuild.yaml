steps:
- name: 'gcr.io/cloud-builders/docker'
  args:
    [ 'build', '-t', 'europe-west4-docker.pkg.dev/$PROJECT_ID/snippets/snippets-image:${_IMAGE_VERSION}', '.' ]
  #this sets the workdir for the build step
  #use this if dockerfile is in subdir from root
  dir: 'snippets'
- name: 'ubuntu'
  entrypoint: 'bash'
  args:
    - '-c'
    - |
      printenv
- name: 'gcr.io/cloud-builders/kubectl'
  id: Deploy
  args:
    - 'apply'
    - '-f'
    - '/workspace/deployments/deployment.yaml'
  env:
    - 'CLOUDSDK_COMPUTE_ZONE=us-central1-b'
    - 'CLOUDSDK_CONTAINER_CLUSTER=hello-cloudbuild'
substitutions:
  _IMAGE_VERSION: v3 # default value
images:
  - 'europe-west4-docker.pkg.dev/$PROJECT_ID/snippets/snippets-image:${_IMAGE_VERSION}'
# deploy container image to GKE
